---
output: github_document
---
<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.show = "hold",
  comment = "#>",
  fig.path = "man/figures/README-"
)
```

# <img src="https://i.imgur.com/vTLlhbp.png" align="right" height=88 /> Analyze forest diversity and dynamics

[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/forestgeo/fgeo.svg?branch=master)](https://travis-ci.org/forestgeo/fgeo)
[![Coverage status](https://codecov.io/gh/forestgeo/fgeo/branch/master/graph/badge.svg)](https://codecov.io/github/forestgeo/fgeo?branch=master)
[![CRAN status](https://www.r-pkg.org/badges/version/fgeo)](https://cran.r-project.org/package=fgeo)

```{r, echo=FALSE}
# Creates a functional link when used with DT table.
fgeo_link <- function(package, topic = NULL) {
  end <- glue::glue(">{package}")
  if (!is.null(topic)) {end <- glue::glue("/reference/>{topic}")}
  glue::glue("<a href=https://forestgeo.github.io/{package}{end}</a>")
}

link_core <- function(pattern) {
  core <- fgeo_to_attach()()
  fgeo_link(core[grepl(pattern, core)])
}

analyze <- "analyze"
visualize <- "map"
manipulate <- "tool"
datasets <- "x"
```

__fgeo__ provides functions to manipulate and visualize [ForestGEO](https://forestgeo.si.edu/) datasets, and to analyze the abundance, demography, and habitats of forest trees.

* [Search functions and datasets](https://forestgeo.github.io/fgeo/articles/siteonly/reference.html)
* [Related projects](https://forestgeo.github.io/fgeo/#related-projects)
* [Try __fgeo__ online](https://bit.ly/fgeo-demo)
* [Ask questions, report bugs, or propose features](https://github.com/forestgeo/fgeo/issues/new)

## Installation

__Expected R environment__

* R version is recent
* All packages are updated (run `update.packages()`)
* No other R session is running
* Current R session is clean (click _Session > Restart R_)

__Option 1: Install directly__

```R
install.packages("devtools")
devtools::install_github("forestgeo/fgeo", upgrade = "never")
```

(If you reach GitHub's rate limit see [`usethis::browse_github_pat()`](https://usethis.r-lib.org/reference/browse_github_pat.html)).

__Option 2: Install via [__fgeo.install__](https://github.com/forestgeo/fgeo.install#-fgeoinstall)__

```R
install.packages("devtools")
devtools::install_github("forestgeo/fgeo.install")

# If needed, installs dependencies from CRAN and fgeo packages from GitHub
fgeo.install::install_fgeo()
```

---

* To upgrade packages see `?devtools::update_packages()`
* To remove packages see `?remove.packages()`



<details> <summary><strong>Tips to avoid or fix common installation problems</strong></summary>

#### Update R, RStudio, and R packages

* [How?](https://fgeo.netlify.com/2018/02/08/2018-02-08-update-r-rstudio-and-r-packages/)
* [Why?](https://fgeo.netlify.com/2018/03/06/2018-03-06-should-i-update-all-my-r-packages-frequently-yes-no-why/)

#### Instruct RStudio not to preserve your workspace between sessions

* [Why?](https://r4ds.had.co.nz/workflow-projects.html#what-is-real)

In RStudio go to _Tools > Global Options..._

<img src="https://i.imgur.com/QqPyHJu.png" align="center" height=450/>

#### Use RStudio projects (or the [__here__](https://here.r-lib.org/) package)

* [Why?](https://www.tidyverse.org/articles/2017/12/workflow-vs-script/)

<img src="https://user-images.githubusercontent.com/5856545/47810353-7d3ef900-dd19-11e8-951f-00afc2280198.png" align="center" height=350/>

#### Restart R many times each day

Press Cmd/Ctrl + Shift + F10 to restart RStudio or go to _Session > Restart R_.


#### Increase the rate limit to install from GitHub

* Ensure you have an account on GitHub (https://github.com/).
* Generate a GitHub token named exactly `GITHUB_PAT` by running `usethis::browse_github_pat()` in R.
* You will be sent to GitHub and you should see something like this:

<img src="https://i.imgur.com/huJ6l7n.png" align="center" height=300/>

...

* Make sure your token description says exactly `GITHUB_PAT` and click _Generate token_

...

<img src="https://i.imgur.com/iXWITVV.png" align="center" height=100/>

* Store your new token in the environmental variable `GITHUB_PAT` by running `usethis::edit_r_environ()` in R.
* A file called .Renviron will open. Type the name and value of your GitHub token. __Ensure to end this file with a new empty line__. Your .Renviron file should now look like this:

<img src="https://i.imgur.com/QSEuzbF.png" align="center" height=100/>

...

* Save and close  .Renviron.

#### Install package development utilities

Sometimes you may want to install the _source_ version of an R package from CRAN or GitHub. If that package contains a `src/` folder you will need to install package development utilities.

* [How?](https://support.rstudio.com/hc/en-us/articles/200486498-Package-Development-Prerequisites)

#### Troubleshoot: error: X11 library is missing: install XQuartz ...

If you are a mac user, __fgeo__ may fail to install with the error below. Install XQuartz from https://www.xquartz.org/ and try to install __fgeo__ again.

```R
Error : .onLoad failed in loadNamespace() for 'tcltk', details:
  call: fun(libname, pkgname)
  error: X11 library is missing: install XQuartz from xquartz.macosforge.org
```

</details>



## Example

Load all __fgeo__ packages in one step.

```{r example}
library(fgeo)
```

#### Explore

On an interactive session, `fgeo_help()` and `fgeo_browse_reference()` help you to search documentation.

```{r}
if (interactive()) {
  # To search on the viewer; accepts keywords
  fgeo_help()
  # To search on a web browser
  fgeo_browse_reference() 
}
```

#### Datasets

__fgeo__ includes multiple small datasets. For example:

```{r}
tree5
```

Some larger datasets are not stored locally but can be downloaded.

```{r}
stem6 <- download_data("luquillo_stem6_random")
stem6
```

For simplicity, let's focus on a few species.

```{r}
few_species <-  c("PREMON", "CASARB")
census <- filter(stem6, sp %in% few_species)

census
```

#### Plot

Common plots are simple to make.

```{r}
autoplot(sp(census))
```

#### Analyze

__fgeo__ includes some common analyses:

* Abundance and basal area

```{r}
abundance(census)

abundance(
  pick_main_stem(census)
)

by_species <- group_by(census, sp)
basal_area(by_species)
```

* Demography

```{r}
# `tree5` and `tree6` come with fgeo
to_df(
  recruitment_ctfs(tree5, tree6)
)
```

* Species-habitats association

```{r}
# `elevation` comes with fgeo
habitats <- fgeo_habitat(elevation, gridsize = 20, n = 4)
autoplot(habitats)
```

```{r}
# This analysis makes sense only for tree tables
tree <- download_data("luquillo_tree5_random")

to_df(
  tt_test(tree, habitats)
)
```

[Get started](https://forestgeo.github.io/fgeo/articles/fgeo.html#get-started)

## Related projects

Additional packages maintained by ForestGEO but not included in __fgeo__:

* [__fgeo.data__](https://forestgeo.github.io/fgeo.data/): Open datasets of ForestGEO.
* [__fgeo.krig__](https://forestgeo.github.io/fgeo.krig/): Analyze soils.



Other packages not maintained by ForestGEO:

* [CTFS-R Package](http://ctfs.si.edu/Public/CTFSRPackage/): The original package of CTFS functions. No longer supported by ForestGEO.
* [__BIOMASS__](https://CRAN.R-project.org/package=BIOMASS): An R package to estimate above-ground biomass in tropical forests.



## R code from recent publications by ForestGEO partners

Data have been made available as required by the journal to enable reproduction of the results presented in the paper. Please do not share these data without permission of the ForestGEO plot Principal Investigators (PIs). If you wish to publish papers based on these data, you are also required to get permission from the PIs of the corresponding ForestGEO plots.

* [Soil drivers of local-scale tree growth in a lowland tropical forest (Zemunik et al., 2018).](https://github.com/SoilLabAtSTRI/Soil-drivers-of-tree-growth)
* [Plant diversity increases with the strength of negative density dependence at the global scale (LaManna et al., 2018)](https://github.com/forestgeo/LaManna_et_al_Science)
    * Response #1: LaManna et al. 2018. Response to Comment on "Plant diversity increases with the strength of negative density dependence at the global scale" Science Vol. 360, Issue 6391, eaar3824. DOI: 10.1126/science.aar3824
    * Response #2: LaManna et al. 2018. Response to Comment on "Plant diversity increases with the strength of negative density dependence at the global scale". Science Vol. 360, Issue 6391, eaar5245. DOI: 10.1126/science.aar5245

## Information

* [Getting help](SUPPORT.md).
* [Contributing](CONTRIBUTING.md).
* [Contributor Code of Conduct](CODE_OF_CONDUCT.md).

## Acknowledgments

Thanks to all partners of ForestGEO for sharing their ideas and code. For feedback on __fgeo__, special thanks to Gabriel Arellano, Stuart Davies, Lauren Krizel, Sean McMahon, and Haley Overstreet. There are many other people that deserve special acknowledgment; I thank them in the documentation and home page of each individual package that make up the __fgeo__ development.
