---
title: "Reference"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Quick Search}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message=FALSE, 
  warning=FALSE,
  collapse = TRUE,
  comment = "#>"
)

library(fgeo)
library(tidyverse)
```

```{r functions}
has_concept <- function(string) {
  fgeo:::search_help() %>% 
    filter(!keyword %in% "internal") %>% 
    family_contains(string) %>% 
    collapse_alias() %>% 
    # TODO: Add param link
    link() %>% 
    dplyr::select(columns())
}

family_contains <- function(entries, string) {
  dplyr::filter(entries, concept %in% string)
}

collapse_alias <- function(entries) {
  entries %>% 
    dplyr::group_by(topic) %>% 
    dplyr::mutate(name = paste0(unique(alias), collapse = ", ")) %>% 
    dplyr::ungroup()
}

link <- function(x) {
  x %>% 
    dplyr::mutate(
      topic = glue::glue_data(
        ., 
        "<a href=https://forestgeo.github.io/\\
        {package}/reference/{topic}>{topic}</a>"
      ),
      package = glue::glue_data(
        ., 
        "<a href=https://forestgeo.github.io/\\
        {package}>{package}</a>"
      )
    ) %>% 
    dplyr::arrange(package)
}

link_pkg <- function(x) {
  glue::glue("<a href=https://forestgeo.github.io/{package}>{package}</a>")
}

datatable_n <- function(x, n = nrow(x)) {
  DT::datatable(x, escape = FALSE, options = list(pageLength = n))
}

columns <- function() {
  c("alias", "topic", "title")
}
```

### Help

```{r}
datatable_n(has_concept("functions to explore fgeo"))
```

### Abundance

```{r}
datatable_n(has_concept("functions for abundance and basal area"))
```

### Demography

```{r}
datatable_n(has_concept("demography functions"))
```

### Habitat

```{r}
datatable_n(has_concept("habitat functions"))
```

### Plot

```{r}
fgeo:::search_help("fgeo.map") %>% 
  collapse_alias() %>% 
  link() %>% 
  dplyr::select(columns()) %>% 
  unique() %>% 
  datatable_n()
```

### Datasets

```{r}
fgeo_x <- fgeo:::search_help("fgeo.x") %>% 
  filter(!keyword %in% "internal") %>% 
  collapse_alias() %>% 
  link() %>% 
  dplyr::select(columns()) %>% 
  unique()
family_datasets <- has_concept("datasets")
all_datasets <- suppressWarnings(dplyr::bind_rows(fgeo_x, family_datasets))

datatable_n(all_datasets)
```
